package main

import (
	"fmt"
	"strings"
)

func ParseInputSimple(input string) (ret [][]string) {
	lines := strings.Split(input, "\n")
	for _, line := range lines {
		list := make([]string, len(line))
		for j, character := range line {
			list[j] = string(character)
		}
		ret = append(ret, list)
	}
	return ret
}

// width needs to be 3*(height-1)+1
func RepeatMapWhileNecessary(input [][]string, widthPitch int) (ret [][]string) {
	ret = make([][]string, len(input))
	for i := range input {
		ret[i] = make([]string, len(input[i]))
		ret[i] = input[i]
	}
	for len(ret[0]) < ((widthPitch * (len(ret) - 1)) + 1) {
		for i, _ := range ret {
			ret[i] = append(ret[i], input[i]...)
		}
	}
	return ret
}

func CountObstaclesMet(input [][]string, ruleRight int, ruleDown int) (ret int) {
	for i := 0; i <= len(input)-1; i++ { // Y
		if i*ruleDown < len(input) && input[i*ruleDown][i*ruleRight] == "#" { // X
			fmt.Println("Obstacle met with params:", ruleRight, ruleDown, "at:", i*ruleRight, i*ruleDown)
			ret++
		}
	}
	return ret
}

func AnswerPart2(input [][]string) (ret int) {
	in1, in3, in5, in7 := RepeatMapWhileNecessary(input, 1), RepeatMapWhileNecessary(input, 3), RepeatMapWhileNecessary(input, 5), RepeatMapWhileNecessary(input, 7)
	obs11, obs31, obs51, obs71, obs12 := CountObstaclesMet(in1, 1, 1), CountObstaclesMet(in3, 3, 1), CountObstaclesMet(in5, 5, 1), CountObstaclesMet(in7, 7, 1), CountObstaclesMet(in1, 1, 2)
	fmt.Println("1,1 :", obs11)
	fmt.Println("3,1 :", obs31)
	fmt.Println("5,1 :", obs51)
	fmt.Println("7,1 :", obs71)
	fmt.Println("1,2 :", obs12)
	return obs11 * obs31 * obs51 * obs71 * obs12
}

func ShowMapSimple(input [][]string) {
	for _, line := range input {
		for _, character := range line {
			fmt.Print(character)
		}
		fmt.Println()
	}
	fmt.Println("Height:", len(input), "Width:", len(input[0]))
}

func main() {
	testInput := "..##.......\n#...#...#..\n.#....#..#.\n..#.#...#.#\n.#...##..#.\n..#.##.....\n.#.#.#....#\n.#........#\n#.##...#...\n#...##....#\n.#..#...#.#"
	testRet := ParseInputSimple(testInput)
	//ShowMapSimple(testRet)
	testRet2 := RepeatMapWhileNecessary(testRet, 3)
	ShowMapSimple(testRet2)
	fmt.Println("Test answer part 1 is:", CountObstaclesMet(testRet2, 3, 1))
	fmt.Println("Test answer part 2 is:", AnswerPart2(testRet2))

	realInput := "..#......###....#...##..#.#....\n.#.#.....#.##.....###...##...##\n..#.#..#...........#.#..#......\n..#......#..........###........\n...#..###..##.#..#.......##..##\n......#.#.##...#...#....###....\n..........##.....##..##......#.\n......#...........#............\n#....#..........#..............\n.#........##.............###.##\n....#.........#.......#.#....##\n#.#..#..#..#.......#...#....##.\n.#........#......#.##.......#..\n..#.....#####.....#....#..#..##\n.......#..##.......#......#.###\n..#.#...#......#.##...#........\n##...................#...##..#.\n......#...#.##...##.#......#..#\n.#.................#..##...#...\n...#.....#.......##.....#.#....\n.......#.#......#.....#..#..##.\n..........#........#...........\n..#.#..........................\n.#.##..#.#...#...#.........#...\n.....#....#.....#..#.....#.....\n...#.#.#.....#.#..#.......#..#.\n.....#...###...##...#......##..\n#.###......#.#...#.#.#..###....\n#.....#..##......#..........#.#\n#...............#........#.#..#\n.....#..#.........#......##.#..\n.....#.##.##..#..##............\n...#......##...............#.#.\n.#..#.#............##.#........\n#.....#..###.............##.#..\n...##..#.#..#...........#..#...\n#....#.........#.#.............\n##.#.........#..###......#.#..#\n...#...#......#.#.#.##..#.##...\n.....##............#.##.##..#..\n....#................#.##..#..#\n...#..#.......#...#..#........#\n....#...#...#................#.\n....##...............#.#...#...\n.#.....###...#.......#.##......\n....######.#..............###.#\n.#..#.........##...............\n................##.#..#....###.\n.......#............#.#..#..#..\n......#.#...............##.#...\n...#..####.#...#..#..#......#..\n....#.#...#.....#.........#..##\n.##..#...#......##....##.#.#...\n.##.#.........##...#....#......\n..#.#..#...#.#..#.......#...#.#\n.........#..#.....##..#........\n..#......#..##.....#..#...###..\n..#...#....#.#..#..#.#.#..#.#..\n...#..#####.....#......#.......\n#.#............#......#..#...#.\n.........#..........###.......#\n......#....#..#.##.#......#..#.\n...........##.#....#.#..#......\n..#...................#..#.#...\n#....##.............##....#...#\n##..#....#.........#..........#\n....#.#.#...#..#........#.##..#\n...............#...#..##..#....\n.##.......#.......#...........#\n#.........................##...\n#........#.#..#..##..####.#....\n...................##.....###..\n.#.......#..#......#......#...#\n..#.........#...#..........#...\n..........#......#....#........\n.#......#..#...#..#...##....##.\n...#.#..#..#......#.....##.####\n.......#.#....#.......#........\n#...#.#...##..##.#......#......\n.#.........#...................\n...#..........#.#......#.......\n...#.....##....#..........#....\n.#..........##..#..#..##....#.#\n.##.#..........#...#.##.......#\n#...###....#..#.#...#..#.......\n..................##...........\n..#...##.#...........#....#.##.\n..#......#..##..#....##..#...#.\n..#....#.....#.##..#.......#..#\n#...#....#..#.#....#......##...\n.......##..#..........#........\n..#.............##.#.....#...#.\n...............#....#...#...##.\n##...........#.......#.##......\n#..#...........#.........#.....\n....###.............###.##..##.\n.........#.#.....###.......#...\n..#.##....#.#..........#....#..\n#........#....##...#..#........\n......#..........###..#.#......\n.....#.#......##.....#..##...#.\n.#.......#......#...#...#...#.#\n.#..........##.......#.....##.#\n###.#...#....#.....#...#......#\n..#.#.#..#.##.#..#.............\n.....#.........................\n.#..###..#...#...#..#..#...#.#.\n#................##...##.##....\n......#...#...#..........#...#.\n..........#.....##.............\n..#.#......#........#.......#..\n........##.............#.......\n.......#......#.##.#..#........\n#.#.#....#........#..........#.\n##..##......#..#..#.....#.#..##\n##..#..........#...............\n#.....##...#.#......#.......#.#\n#.....#...#....#..#.....##.....\n##..........#.#.....#....#...##\n..##.###..#.....#.......#...#..\n.#.#.......#......###........#.\n.#..............#.#..###.......\n.#....#..##.........#..#.#.....\n....#....#.#....#..#.......##.#\n#.......#.......#.........#....\n...#....#....#.....##..#..#.#.#\n........#....#...........#.....\n.#......##.#.#.##..............\n#..#.#.....##........#........#\n##...#.#.......##.......#...#..\n#...#.....#.##...##.#.....#....\n....#..##...#........#.#...#...\n...#....#.#.#..###...##.#.....#\n......#..#.....#..#........##..\n.......#.....#.#.........#.#..#\n..#.......#.#.#.#.#....#.##...#\n.#...#........#..##..#......#..\n.#..#............#...#..#.#....\n...##......#......#............\n..#...#.#.....#.....#..##.#....\n.#......#.#......#..#.#........\n..#..........##...#.#.....#..#.\n#...#.....#..#...#.............\n..##.................#....#....\n.#....#.......#..##....#......#\n.#....###............##....##.#\n##..#........#..#...#.......#..\n.....#.....#.#.#.##.........#..\n.......#..#....#...#...#.......\n...#...#...#.#.#..#.#.....#....\n#.#........#..#.##..#..###.....\n..................#..#.........\n#.#.....#..##.........#.......#\n###..#.......#..............#..\n......#..#.....###..........#..\n....#.#...#..#...........#.#...\n...#.....#.......#.....#.#.....\n#.....##..#......##...........#\n#...###...........##..#...#.##.\n......##.##.#...#..#....#......\n...#.#......##.#......##....#.#\n..............#.#.###.......#..\n........#....#.......##..#..###\n...#.....##.#....#......##..#.#\n..##........#.....#.#..#...#...\n.#..#.##.........#.....#...#..#\n..#..#....#...........#........\n.#...#....................#....\n##.....##....#.............#.#.\n....#.#..#.#..#.#.#..........##\n.............##.#.....#..#..#..\n.#....#.....##...#.###.........\n..#........#........#.#..###...\n.##....#...#...#.......#...#.#.\n..#...#...#..##........#..#....\n..##.#..#..#.....#......#.#..#.\n.#........#..#....#..#.........\n..#.#.....#.##..#........###.#.\n.....#.##.....##.#.............\n#.........#.......#...##...#...\n..#.##.#..#..#............#....\n.##....#..#............#.....#.\n###........##.....##.#...#.....\n#......##..##.#.#.#.#.#.#..##..\n.....###.....#....#......#....#\n........#.........##...#....#.#\n.#.#.....#.#..#..##......#...#.\n...#.##....#..#.###..#..##.....\n....#..........##..#..#..#..#..\n...#..#.##..#..#....#.........#\n.....#..###.#.....#.....#..#...\n......#...#....#.##...#.#......\n.#.###..##.....##.##......##...\n.....#.#...........#.#.........\n#........#...#..#......##.#....\n..#.......##....##....#.##.#..#\n...###.#.........#......#.....#\n..#.##..#....#.....##...#.##...\n....##.##.............#...#....\n##..#...#..#..#..#.............\n.....#.....#.....#.............\n...#.##.......#..#.#.....#....#\n#.....##.........#......##.....\n.....##..........#..#...#..#...\n#...###....#.......#...##......\n.#....#..#......#.....#...#.#..\n#........#.#.#...#.....###.#.##\n##...#...##..#..#....#.........\n....#............#..#.....#....\n#......#.........##....#.......\n.#..#..#........#.............#\n.##..........#......#.......#..\n#............#..#....#.........\n....#.#.....#.##...#.....#.#...\n...#.#..#...##..#...#.#.#......\n#....#..#.........##..#.#.#..##\n.#...#..............#.......#..\n#...#.....#.#........##......##\n...#....##.####.#.........#.#.#\n....###.#..#............#.#..#.\n....#......#...#......##.#.#.#.\n.....#..#.#.##.#...##..........\n##..#...#.#...###.............#\n....#...#..#.....#.#..#..#..#..\n#..........####......#.....###.\n.........#........#.##.#...#...\n.........#..........#.#..###...\n.....##........##.........#...#\n..##....#...#.......##.........\n.....#.#......##....#...#...#..\n.##..#..##.....................\n.......#...#..#..#...##....#...\n.#...#.......###...#..#..#.....\n.......#.....##.##.#.......#..#\n.##......#...#....#..#......##.\n.##....#..#....#...#...#.......\n.........##..#..#.#.#.....##...\n...#..............#..#.....####\n.#.#.#..#.......#.......#......\n..#.#......#..........#........\n.#...#.#..#.......#..#..#..#...\n.......##.#...#..#....#.....#..\n.##...##....##...#........####.\n....#.#..##....#...#....#.#....\n.....#.....#..#..#.#.##..#.....\n..#....#..............#....#...\n..#.#.#.....##.#.....#..##.....\n....#.....#....#...#...#..#.#..\n#...#...........#..#..#........\n...#.#..#.........##.#...#..##.\n......#.#.........#.#...#......\n......#..##.###......##.#....#.\n.....#...#..#.......#..........\n.#...#.......#.....###......#..\n...........##.....#..#..#....#.\n..#....#..#...#......#.......#.\n..#...#...#.#..#....#...#......\n.......#....###.####...###.#...\n#.##.#.......#.......#....#.#.#\n.##..........#.....#..###......\n.....#...........#.##..#....#..\n........##.....#.#........##...\n#..#..#..................##....\n#...###..........#.............\n.......#.#.......#.#.......##..\n.....#.#...#....#...####.....#.\n..##.....##.......#....#.......\n##..........#...#..##....##....\n..........#..#......#........#.\n##..#....#..#....#.....##....#.\n##.##.....#...##.##.......#....\n..#..#.###.#..##.#..#..#...#...\n.#..#.....#........#...##.#....\n..#..#.....#.#......##.#.#.....\n.#..##...#.#....#...#...#.#.##.\n.........#...#....###.#.....#..\n...........###.#.#..#..#...#.#.\n##...#......##...........#..#..\n.........##..#...#.......#.....\n#......#.#..........#..#.......\n...#.................#....#....\n#....#......................##.\n##.......#..#......#.#...###.#.\n..#....#..#.#......#...........\n...#...........###.#.#.........\n..#..##.....#.....##...##......\n..#..#.#.#.#..#..#..##....#...#\n#......##.....##..##.##...#....\n#.....#.....#.#........#.......\n.#.....#.................#....#\n.###....#...#............#.#.#.\n.#...#.#......#.#..............\n....#...#......#.....#.......#.\n........#.....#..........#....#\n#..#......#...#...#.........#..\n#....#......#...##.#...#...#...\n#...#....#....#..#..#.....#..#.\n#......##..#..#.#.#..#.#.......\n..#..#...............#...##...#\n............#..............#.##\n.#.#.#......##.......#.......#.\n....#.........##.......#...###.\n.......#.#...#.#.#.......#.....\n....#..#..#...#....#.##.#.##...\n...##.##.#...#......#..........\n#.....#...#.#...#.##..##.#.....\n.......#.....#...#.#...##.#....\n.#.............#.....#....##..#\n##......#.......#...#....#.....\n.###......#.................#..\n#.#......##.........##..#......\n...#....#..........#.#.........\n..##..#.........#..............\n.....#...#..................#.#\n.............#.........#...#..#\n....#....#......#.#.......#...#\n#..#............#.#.......#...#\n..#.....#............#.........\n.#.....................###....#\n........#.####.........#.#.#...\n#...........##...#.........#..#\n...........#..#......#...#.#...\n....##...##.....#.....#........"
	realRet := ParseInputSimple(realInput)
	//ShowMapSimple(realRet)
	realRet2 := RepeatMapWhileNecessary(realRet, 3)
	//ShowMapSimple(realRet2)
	fmt.Println("Real answer part 1 is:", CountObstaclesMet(realRet2, 3, 1))
	fmt.Println("Real answer part 2 is:", AnswerPart2(realRet))
}
